"use strict";(self._cf=self._cf||[]).push([[1054],{587616:(e,t,n)=>{n.d(t,{Z:()=>l});var r=n(991332),o=n(322584),a=n(890369),i=n(79680),s=n(933177);const c={};class l{constructor(e){this.mediaStore=e}createFileStateObserver(e,t){const n=new o.ReplaySubject(1),a=(0,r.Z)({id:e},t),s=(0,i.eS)({data:a});return n.next(s),n}populateCache(e){e.forEach((e=>{const t=this.createFileStateObserver(e.id,e.details);(0,a.Q)().set(e.id,t)}))}removeFromCache(e,t){const n=c[t].items.findIndex((t=>t.id===e));-1!==n&&((0,a.Q)().remove(e),c[t].items.splice(n,1))}getItems(e,t,n){c[e]||(c[e]={items:[],subject:new o.ReplaySubject(1),isLoadingNextPage:!1});const a=c[e],i=a.subject;return this.mediaStore.getCollectionItems(e,(0,r.Z)((0,r.Z)({},t),{},{details:"full"}),n).then((e=>{const{contents:t,nextInclusiveStartKey:n}=e.data;this.populateCache(t),a.items=e.data.contents,a.nextInclusiveStartKey=n,i.next(a.items)})).catch((e=>i.error(e))),(0,s.u)(i)}async removeFile(e,t,n,r){await this.mediaStore.removeCollectionFile(e,t,n,r),this.removeFromCache(e,t);const o=c[t];o.subject.next(o.items)}async loadNextPage(e,t,n){const o=c[e],a=!!o&&o.isLoadingNextPage;if(!o||!o.nextInclusiveStartKey||a)return;o.isLoadingNextPage=!0;const{nextInclusiveStartKey:i,items:s,subject:l}=c[e],d=await this.mediaStore.getCollectionItems(e,(0,r.Z)((0,r.Z)({},t),{},{inclusiveStartKey:i,details:"full"}),n),{contents:u,nextInclusiveStartKey:h}=d.data;this.populateCache(u);const m=[...s,...d.data.contents];l.next(m),c[e]={items:m,nextInclusiveStartKey:h,subject:l,isLoadingNextPage:!1}}}},920148:(e,t,n)=>{n.d(t,{y:()=>o,p:()=>a});var r=n(893793);class o extends r.tM{constructor(e,t,n){super(e),this.reason=e,this.id=t,this.metadata=n}get attributes(){const{reason:e,id:t,metadata:{collectionName:n,occurrenceKey:r}={}}=this;return{reason:e,id:t,collectionName:n,occurrenceKey:r}}}function a(e){return e instanceof o}},619569:(e,t,n)=>{n.d(t,{oT:()=>K});var r=n(991332),o=n(29298),a=n(731867),i=n(81218),s=n(455629),c=n(712749),l=n(197728),d=n.n(l),u=(n(73377),n(501341)),h=n(655444),m=n(907086),p=n(79680),y=n(920148),w=n(289653),g=n(890369),f=n(700406),b=n(954889),v=n(433436),x=n.n(v),S=n(365681),Z=n(932125);const C=e=>{if(e.content instanceof Blob){const t=e.content.type;return(0,Z.L4)(t)}return"unknown"},I=(e,t)=>(0,p.f6)(e)||"unknown"!==e.mediaType?{}:{mediaType:t},F=e=>{const t=e.split(",")[1],n=atob(t),r=[];for(let o=0;o<n.length;o+=512){const e=n.slice(o,o+512),t=e.split("").map(((t,n)=>e.charCodeAt(n))),a=new Uint8Array(t);r.push(a)}return new Blob(r,{type:"image/jpeg"})};var U=n(933177),T=n(362716),N=n(895524),E=n(629413),P=n(370353),B=n(374171),k=n(273167),L=n(316864);class K{constructor(e,t){(0,o.Z)(this,"createDownloadFileStream",((e,t,n)=>{const r=(0,N.O)(),o=new B.D;return o.onError=e=>r.error(e),o.execute((async()=>{const a=await this.dataloader.load({id:e,collectionName:t});if(!a)throw new y.y("emptyItems",e,{collectionName:t,occurrenceKey:n});if((0,k.d)(a))throw new y.y("zeroVersionFile",e,{collectionName:t,occurrenceKey:n});const i=(0,p.L5)(e,a);switch(r.next(i),i.status){case"processing":o.next();break;case"processed":r.complete()}})),r})),(0,o.Z)(this,"getUploadingFileStateBase",((e,t)=>{"string"==typeof e.content&&(e.content=F(e.content));const{content:n,name:r=""}=e,{id:o,occurrenceKey:a}=t;let i,s=0,c="";n instanceof Blob&&(s=n.size,c=n.type,(0,E.PU)(n.type)&&(i={value:n,origin:"local"}));return{id:o,occurrenceKey:a,name:r,size:s,mediaType:C(e),mimeType:c,preview:i}})),this.mediaStore=e,this.featureFlags=t,this.dataloader=(0,S.dR)(e)}getFileState(e,t={}){const{collectionName:n,occurrenceKey:r}=t;if(!x()(e)){const t=(0,N.O)();return t.error(new y.y("invalidFileId",e,{collectionName:n,occurrenceKey:r})),(0,U.u)(t)}return(0,U.u)((0,g.Q)().getOrInsert(e,(()=>this.createDownloadFileStream(e,n))))}getCurrentState(e,t){return((e,t=new a.Subscription)=>new Promise(((n,r)=>t.add(e.subscribe({next:e=>{n(e),t.unsubscribe()},error:e=>{r(e),t.unsubscribe()}})))))(this.getFileState(e,t))}getArtifactURL(e,t,n){return this.mediaStore.getArtifactURL(e,t,n)}getFileBinaryURL(e,t){return this.mediaStore.getFileBinaryURL(e,t)}touchFiles(e,t,n){return this.mediaStore.touchFiles({descriptors:e},{collection:t},n).then((({data:e})=>e))}generateUploadableFileUpfrontIds(e,t){const n=d()(),r=d()(),o={fileId:n,occurrenceKey:r,collection:e};return{id:n,occurrenceKey:r,deferredUploadId:this.touchFiles([o],e,t).then((e=>e.created[0].uploadId))}}async uploadExternal(e,t,n){const r=this.generateUploadableFileUpfrontIds(t,n),{id:o,occurrenceKey:a}=r,i=(0,N.O)(),s=fetch(e).then((e=>e.blob())).catch((()=>{})),c=new Promise((async(e,t)=>{const n=await s;n||t("Could not fetch the blob"),e({value:n,origin:"remote"})})),l=e.split("/").pop()||"",d={status:"processing",name:l,size:0,mediaType:"unknown",mimeType:"",id:o,occurrenceKey:a,preview:c};return i.next(d),(0,g.Q)().set(o,i),new Promise((async(e,d)=>{const u=await s;if(!u)return d("Could not download remote file");const{type:h,size:m}=u,p={content:u,mimeType:h,collection:t,name:l},y=(0,Z.L4)(h);i.next({status:"processing",name:l,size:m,mediaType:y,mimeType:h,id:o,occurrenceKey:a,preview:c}),this.upload(p,void 0,r,n);e({dimensions:await(0,T.x)(y,u),uploadableFileUpfrontIds:r})}))}uploadAwlaysPullFileStates(e,t,n,o){const{collection:i}=e,c=n||this.generateUploadableFileUpfrontIds(i,o),{id:l,occurrenceKey:d}=c,u=this.getUploadingFileStateBase(e,c),h=(0,N.O)();(0,g.Q)().set(l,h);const m=e=>{h.next((0,r.Z)((0,r.Z)({status:"uploading"},u),{},{progress:e}))};let p=new a.Subscription;const{cancel:y}=(0,w.c)(e,this.mediaStore,c,{onUploadFinish:e=>{if(e)return h.error(e);p=this.createDownloadFileStream(l,i,d).pipe((0,s.map)((e=>(0,r.Z)((0,r.Z)((0,r.Z)({},u),e),I(e,u.mediaType))))).subscribe(h)},onProgress:m},o);return null==t||t.setAbort((()=>{y(),p.unsubscribe()})),setTimeout(m,0,0),(0,U.u)(h)}uploadConditionallyPullFileStates(e,t,n,o){"string"==typeof e.content&&(e.content=F(e.content));const{content:l,name:d="",collection:u}=e;n||(n=this.generateUploadableFileUpfrontIds(u,o));const h=n.id,m=n.occurrenceKey;let p,y="",f=0;const b=C(e),v=(0,N.O)(),x=new a.Subscription;l instanceof Blob&&(f=l.size,y=l.type,(0,E.PU)(l.type)&&(p={value:l,origin:"local"}));const S={id:h,occurrenceKey:m,name:d,size:f,mediaType:b,mimeType:y,preview:p},Z=e=>{v.next((0,r.Z)((0,r.Z)({status:"uploading"},S),{},{progress:e}))},{cancel:T}=(0,w.c)(e,this.mediaStore,n,{onUploadFinish:e=>{if(e)return v.error(e);x.add((0,P.J)(b,y,p).pipe((0,c.b)((e=>e?this.createDownloadFileStream(h,u,m).pipe((0,s.map)((e=>(0,r.Z)((0,r.Z)((0,r.Z)({},S),e),I(e,b))))):(0,i.of)((0,r.Z)({status:"processing",representations:{}},S))))).subscribe(v))},onProgress:Z},o);return(0,g.Q)().set(h,v),setTimeout((()=>{Z(0)}),0),t&&t.setAbort((()=>{T(),x.unsubscribe()})),(0,U.u)(v)}upload(e,t,n,r){return(0,L.OC)("fetchFileStateAfterUpload",this.featureFlags)?this.uploadAwlaysPullFileStates(e,t,n,r):this.uploadConditionallyPullFileStates(e,t,n,r)}async downloadBinary(e,t="download",n){const r=await this.mediaStore.getFileBinaryURL(e,n);(0,h.G)(r,{name:t}),f.h.emit("media-viewed",{fileId:e,isUserCollection:n===b.a1,viewingLevel:"download"})}async copyFile(e,t,n={},o){const{authProvider:a,collection:i,id:s}=e,{authProvider:c,collection:l,replaceFileId:d,occurrenceKey:h}=t,{preview:w,mimeType:f}=n,b=t.mediaStore||new m.Fq({authProvider:c}),v={sourceFile:{id:s,collection:i,owner:(0,u.pl)(await a({collectionName:i}))}},x={collection:l,replaceFileId:d,occurrenceKey:h},S=(0,g.Q)();let C;try{const{data:e}=await b.copyFileWithToken(v,x,o),t=(0,r.Z)((0,r.Z)({},e),f?{mimeType:f}:void 0),{id:n,mimeType:a}=t,i=a?(0,Z.L4)(a):"unknown",s=(0,p.eS)({data:t}),c=S.get(n)||(0,N.O)(),d=!(0,p.f6)(s)&&w?{preview:w}:{};return!(0,p.nT)(s)&&a&&await(0,P.M)(i,a,w)?(c.next((0,r.Z)((0,r.Z)((0,r.Z)({},s),I(s,i)),d)),C=this.createDownloadFileStream(n,l,h).subscribe({next:e=>c.next((0,r.Z)((0,r.Z)((0,r.Z)({},e),I(e,i)),!(0,p.f6)(e)&&d)),error:e=>c.error(e),complete:()=>c.complete()})):(0,p.y2)(s)||c.next((0,r.Z)((0,r.Z)({},s),!(0,p.f6)(s)&&d)),S.has(n)||(0,g.Q)().set(n,c),e}catch(y){if(C&&C.unsubscribe(),d){const t=S.get(d);t?t.error(y):S.set(s,(0,N.O)(y))}throw y}}}},309137:(e,t,n)=>{n.d(t,{Q:()=>c});var r=n(791306),o=n(907086),a=n(587616),i=n(619569),s=n(218435);class c{constructor(e,t){this.mediaClientConfig=e,this.featureFlags=t,this.mediaStore=new o.Fq({authProvider:e.authProvider,initialAuth:e.initialAuth},t),this.config=e,this.collection=new a.Z(this.mediaStore),this.file=new i.oT(this.mediaStore,t),this.eventEmitter=new r.EventEmitter2,this.stargate=new s.E(e.stargateBaseUrl)}getImage(e,t,n,r,o){return this.mediaStore.getImage(e,t,n,r,o)}getImageUrl(e,t){return this.mediaStore.getFileImageURL(e,t)}getImageUrlSync(e,t){return this.mediaStore.getFileImageURLSync(e,t)}async getImageMetadata(e,t){return(await this.mediaStore.getImageMetadata(e,t)).metadata}async mobileUploadPromise(){if(this.mobileUpload)return this.mobileUpload;const e=await Promise.all([n.e(61769),n.e(11216),n.e(93964),n.e(63894),n.e(94761)]).then(n.bind(n,67342));return this.mobileUpload=new e.MobileUploadImpl(this.mediaStore),this.mobileUpload}on(e,t){this.eventEmitter.on(e,t)}off(e,t){this.eventEmitter.off(e,t)}emit(e,t){return this.eventEmitter.emit(e,t)}}},140995:(e,t,n)=>{n.d(t,{r:()=>o,W:()=>a});var r=n(893793);class o extends r.tM{constructor(e,t){super(e),this.reason=e,this.innerError=t}get attributes(){const{reason:e,innerError:t}=this;return{reason:e,innerError:t}}}function a(e){return e instanceof o}},907086:(e,t,n)=>{n.d(t,{Fq:()=>g,rl:()=>v,ro:()=>x});var r=n(991332),o=n(29298),a=n(594047),i=n(954889),s=n(140776),c=n(242494),l=n(332691),d=n(140995);const u="media-api-region",h="media-api-environment",m={"max-age":i.NK,allowAnimated:!0,mode:"crop"},p={limit:30,sortDirection:"desc"},y=(e,t=!1)=>(0,r.Z)((0,r.Z)((0,r.Z)({},m),e),t?{width:i.xQ,height:i.xQ}:{}),w={Accept:"application/json","Content-Type":"application/json"};class g{constructor(e,t){(0,o.Z)(this,"resolveAuth",(e=>(async(e,t,n=1e4)=>{let r;try{r=await Promise.race([e(t),(o=n,a=new d.r("authProviderTimedOut"),new Promise(((e,t)=>{setTimeout(t,o,a)})))])}catch(i){if(i instanceof d.r)throw i;throw new d.r("failedAuthProvider",i instanceof Error?i:void 0)}var o,a;if(!r)throw new d.r("emptyAuth");return r})(this.config.authProvider,e))),(0,o.Z)(this,"resolveInitialAuth",(()=>(e=>{if(!e)throw new d.r("missingInitialAuth");return e})(this.config.initialAuth))),this.config=e,this.featureFlags=t}async getCollectionItems(e,t,n){const o={method:"GET",endpoint:"/collection/{collectionName}/items"},a=(0,r.Z)((0,r.Z)({},o),{},{authContext:{collectionName:e},params:(0,r.Z)((0,r.Z)({},p),t),headers:{Accept:"application/json"},traceContext:n}),i=await this.request(`/collection/${e}/items`,a),{data:{contents:s,nextInclusiveStartKey:c}}=await(0,l.jV)(o)(i);return{data:{contents:s.filter((e=>e.details.size&&e.details.size>0)),nextInclusiveStartKey:c}}}async removeCollectionFile(e,t,n,o){const a={actions:[{action:"remove",item:{type:"file",id:e,occurrenceKey:n}}]},i=(0,r.Z)((0,r.Z)({},{method:"PUT",endpoint:"/collection/{collectionName}"}),{},{authContext:{collectionName:t},headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(a),traceContext:o});await this.request(`/collection/${t}`,i)}createUpload(e=1,t,n){const o={method:"POST",endpoint:"/upload"},a=(0,r.Z)((0,r.Z)({},o),{},{authContext:{collectionName:t},params:{createUpTo:e},headers:{Accept:"application/json"},traceContext:n});return this.request("/upload",a).then((0,l.jV)(o))}async uploadChunk(e,t,n,o,a,i){const s=(0,r.Z)((0,r.Z)({},{method:"PUT",endpoint:"/chunk/{etag}"}),{},{params:{uploadId:n,partNumber:o},authContext:{collectionName:a},body:t,traceContext:i});await this.request(`/chunk/${e}`,s)}probeChunks(e,t,n,o){const a={method:"POST",endpoint:"/chunk/probe"},i=(0,r.Z)((0,r.Z)({},a),{},{params:{uploadId:t},authContext:{collectionName:n},headers:w,body:JSON.stringify({chunks:e}),traceContext:o});return this.request("/chunk/probe",i).then((0,l.jV)(a))}createFileFromUpload(e,t={},n){const o={method:"POST",endpoint:"/file/upload"},a=(0,r.Z)((0,r.Z)({},o),{},{authContext:{collectionName:t.collection},params:t,headers:w,body:JSON.stringify(e),traceContext:n});return this.request("/file/upload",a).then((0,l.jV)(o))}touchFiles(e,t={},n){const o={method:"POST",endpoint:"/upload/createWithFiles"},a=(0,r.Z)((0,r.Z)({},o),{},{authContext:{collectionName:t.collection},headers:w,body:JSON.stringify(e),traceContext:n});return this.request("/upload/createWithFiles",a).then((0,l.jV)(o))}getFile(e,t={},n){const o={method:"GET",endpoint:"/file/{fileId}"},a=(0,r.Z)((0,r.Z)({},o),{},{authContext:{collectionName:t.collection},params:t,traceContext:n});return this.request(`/file/${e}`,a).then((0,l.jV)(o))}async getFileImageURL(e,t){const{collection:n}=t||{},r=await this.resolveAuth({collectionName:n});return this.createFileImageURL(e,r,t)}getFileImageURLSync(e,t){const n=this.resolveInitialAuth();return this.createFileImageURL(e,n,t)}createFileImageURL(e,t,n){const r={params:y(n),auth:t};return(0,l.uJ)(`${t.baseUrl}/file/${e}/image`,r)}async getFileBinaryURL(e,t){const n=await this.resolveAuth({collectionName:t}),r={params:{dl:!0,collection:t,"max-age":i.NK},auth:n};return(0,l.uJ)(`${n.baseUrl}/file/${e}/binary`,r)}async getArtifactURL(e,t,n){const r=(0,s.l)(e,t);if(!r)throw new Error(`artifact ${t} not found`);const o=await this.resolveAuth({collectionName:n}),a={params:{collection:n,"max-age":i.NK},auth:o};return(0,l.uJ)(`${o.baseUrl}${r}`,a)}async getImage(e,t,n,o,a){const i={};const s={method:"GET",endpoint:"/file/{fileId}/image"},c=(0,r.Z)((0,r.Z)({},s),{},{authContext:{collectionName:t&&t.collection},params:y(t,o),headers:i,traceContext:a});return this.request(`/file/${e}/image`,c,n).then((0,l.Yb)(s))}async getItems(e,t,n){const o=e.map((e=>({type:"file",id:e,collection:t}))),a={method:"POST",endpoint:"/items"},i=(0,r.Z)((0,r.Z)({},a),{},{authContext:{collectionName:t},headers:w,body:JSON.stringify({descriptors:o}),traceContext:n});return this.request("/items",i).then((0,l.jV)(a))}async getImageMetadata(e,t,n){const o={method:"GET",endpoint:"/file/{fileId}/image/metadata"},a=(0,r.Z)((0,r.Z)({},o),{},{authContext:{collectionName:t&&t.collection},params:t,traceContext:n});return this.request(`/file/${e}/image/metadata`,a).then((0,l.jV)(o))}async appendChunksToUpload(e,t,n,o){const a=(0,r.Z)((0,r.Z)({},{method:"PUT",endpoint:"/upload/{uploadId}/chunks"}),{},{authContext:{collectionName:n},headers:w,body:JSON.stringify(t),traceContext:o});await this.request(`/upload/${e}/chunks`,a)}copyFileWithToken(e,t,n){const o={method:"POST",endpoint:"/file/copy/withToken"},a=(0,r.Z)((0,r.Z)({},o),{},{authContext:{collectionName:t.collection},params:t,headers:w,body:JSON.stringify(e),traceContext:n});return this.request("/file/copy/withToken",a).then((0,l.jV)(o))}async request(e,t={method:"GET",endpoint:void 0,authContext:{}},n){const{method:o,endpoint:i,authContext:s,params:l,headers:d,body:m,clientOptions:p,traceContext:y}=t,w=await this.resolveAuth(s),g=y?(0,r.Z)((0,r.Z)({},y),{},{spanId:(null==y?void 0:y.spanId)||(0,a.QB)(8)}):void 0,f=await(0,c.WY)(`${w.baseUrl}${e}`,{method:o,endpoint:i,auth:w,params:l,headers:d,body:m,clientOptions:p,traceContext:g},n);return b(u,f.headers.get("x-media-region")),b(h,f.headers.get("x-media-env")),f}}const f=e=>window&&window.sessionStorage&&window.sessionStorage.getItem(e)||void 0,b=(e,t)=>{if(!t||!window||!window.sessionStorage)return;window.sessionStorage.getItem(e)!==t&&window.sessionStorage.setItem(e,t)},v=()=>f(h),x=()=>f(u)},218435:(e,t,n)=>{n.d(t,{E:()=>r});class r{constructor(e){this.baseUrl=e||"/gateway/api"}async fetchToken(e){return(await fetch(`${this.baseUrl}/media/auth/smartedge`,{credentials:"include",headers:{"x-client-id":e}})).json()}isTokenExpired(e){const t=(new Date).getTime()/1e3;return e.data.iat+e.data.expiresIn-t<0}}},954889:(e,t,n)=>{n.d(t,{a1:()=>o,NK:()=>a,xQ:()=>i,kr:()=>s,wl:()=>c,f0:()=>l});var r=n(265139);const o="recents",a=2592e3,i=4096,s=4*r.xS.MB,c=1e3,l=2*r.xS.TB},140776:(e,t,n)=>{n.d(t,{l:()=>r});const r=(e,t)=>{const n=e[t];if(n&&n.url)return n.url}},265139:(e,t,n)=>{n.d(t,{dw:()=>o,oU:()=>a,xS:()=>i});var r=n(316864);const o=(e,t)=>{const n=["audio","video","image"];return(0,r.OC)("newCardExperience",t)?[...n,"doc"].indexOf(e)>-1:n.indexOf(e)>-1},a=e=>!!e.mediaType&&!!e.mimeType&&!!e.processingStatus;let i;!function(e){e[e.MB=1048576]="MB",e[e.GB=1073741824]="GB",e[e.TB=1099511627776]="TB"}(i||(i={}))},289653:(e,t,n)=>{n.d(t,{c:()=>g});var r=n(421191),o=n(253025),a=n(712749);let i=null;const s=async()=>{if(!i)try{const{WorkerHasher:e}=await Promise.all([n.e(11216),n.e(90052),n.e(23604)]).then(n.bind(n,723604));i=new e(3)}catch(e){const{SimpleHasher:t}=await Promise.all([n.e(90052),n.e(1155)]).then(n.bind(n,301155));i=new t}return i};var c=n(893793);class l extends c.tM{constructor(e,t,n){super(e),this.reason=e,this.id=t,this.metadata=n}get attributes(){const{reason:e,id:t,metadata:{collectionName:n,occurrenceKey:r}={}}=this;return{reason:e,id:t,collectionName:n,occurrenceKey:r}}}var d=n(954889),u=n(265139);const h="fileSizeExceedsLimit",m=async e=>(await s()).hash(e),p=(e,t,n,r)=>async o=>{const a=(await e.probeChunks(f(o),await t,n,r)).data.results;return Object.values(a).map((e=>e.exists))},y=(e,t,n,r)=>async o=>await e.uploadChunk(o.hash,o.blob,await t,o.partNumber,n,r),w=(e,t,n,r)=>{let o=0;return async a=>{await e.appendChunksToUpload(await t,{chunks:f(a),offset:o},n,r),o+=a.length}},g=(e,t,n,i,s)=>{const{content:c,collection:g}=e,{deferredUploadId:f,id:b,occurrenceKey:v}=n;let x=d.kr;try{c instanceof Blob&&(x=(e=>{if(e>d.f0)throw new Error(h);return e<=5*u.xS.GB?5*u.xS.MB:e>5*u.xS.GB&&e<=50*u.xS.GB?50*u.xS.MB:e>50*u.xS.GB&&e<=.95*u.xS.TB?100*u.xS.MB:210*u.xS.MB})(c.size))}catch(I){return I instanceof Error&&I.message===h&&(null==i||i.onUploadFinish(new l(I.message,b,{collectionName:g,occurrenceKey:v}))),{cancel:()=>{null==i||i.onUploadFinish("canceled")}}}const S=(0,r.G)(c,{hashingFunction:m,hashingConcurrency:5,probingBatchSize:100,chunkSize:x,uploadingConcurrency:3,uploadingFunction:y(t,f,g,s),probingFunction:p(t,f,g,s),processingBatchSize:d.wl,processingFunction:w(t,f,g,s)},{onProgress(e){i&&i.onProgress(e)}}),Z=i&&i.onUploadFinish||(()=>{}),C=(0,o.D)(f).pipe((0,a.b)((r=>S.pipe((0,a.b)((()=>(0,o.D)((async(e,t,n,r,o)=>{const{collection:a,name:i,mimeType:s}=e,{id:c,occurrenceKey:l}=n;return t.createFileFromUpload({uploadId:r,name:i,mimeType:s},{occurrenceKey:l,collection:a,replaceFileId:c},o)})(e,t,n,r,s)))))))).subscribe({error:e=>Z(e),complete:()=>Z()});return{cancel:()=>{C.unsubscribe(),Z("canceled")}}},f=e=>e.map((e=>e.hash))},362716:(e,t,n)=>{n.d(t,{x:()=>o});var r=n(477666);const o=async(e,t)=>{switch(e){case"image":{const e=URL.createObjectURL(t);try{return await(e=>new Promise(((t,n)=>{const r=new Image;r.src=e,r.onload=()=>t({width:r.width,height:r.height}),r.onerror=n})))(e)}finally{URL.revokeObjectURL(e)}}case"video":return(0,r.t)(t);default:throw new Error(`Can't extract dimensions from ${e}`)}}},933177:(e,t,n)=>{n.d(t,{u:()=>o,g:()=>a});var r=n(895524);function o(e){return{subscribe:t=>{const n=e.subscribe(t);return{unsubscribe:()=>{n.unsubscribe()}}}}}function a(e){return o((0,r.O)(e))}},388484:(e,t,n)=>{n.d(t,{L:()=>o,N:()=>a});var r=n(893793);class o extends r.tM{constructor(e,t,n){super(e),this.reason=e,this.metadata=t,this.innerError=n}get attributes(){const{reason:e,metadata:{method:t,endpoint:n,mediaRegion:r,mediaEnv:o,attempts:a,clientExhaustedRetries:i,statusCode:s}={},innerError:c}=this;return{reason:e,method:t,endpoint:n,mediaRegion:r,mediaEnv:o,attempts:a,clientExhaustedRetries:i,statusCode:s,innerError:c}}}function a(e){return e instanceof o}},332691:(e,t,n)=>{n.d(t,{Yb:()=>g,jV:()=>w,j_:()=>v,uJ:()=>u,B1:()=>h,Fr:()=>b,n0:()=>i,no:()=>c,wc:()=>p,nr:()=>m,pO:()=>y});var r=n(991332),o=n(501341);var a=n(388484);function i(e){return e instanceof Error&&"request_cancelled"===e.message||!!e&&"AbortError"===e.name}function s(e){return e instanceof TypeError}function c(e){return!!e&&(0,a.N)(e)&&429===e.attributes.statusCode||!!e&&!!e.message&&e.message.includes("429")}const l="x-b3-traceid",d="x-b3-spanid";function u(e,{params:t,auth:n}){const a=new URL(e),i=n&&function(e){return(0,o.Wf)(e)?{client:e.clientId,token:e.token}:{issuer:e.asapIssuer,token:e.token}}(n)||{},s=(0,r.Z)((0,r.Z)({},t),i);return Object.entries(s).filter((([e,t])=>null!=t)).forEach((e=>{a.searchParams.append(...e)})),a.searchParams.sort(),a.toString()}function h(e,t,n){if(t||n||e)return(0,r.Z)((0,r.Z)((0,r.Z)({},null!=e?e:{}),function(e){return e?(0,o.Wf)(e)?{"X-Client-Id":e.clientId,Authorization:`Bearer ${e.token}`}:{"X-Issuer":e.asapIssuer,Authorization:`Bearer ${e.token}`}:{}}(t)),(e=>e?{[l]:e.traceId,[d]:e.spanId}:{})(n))}async function m(e){console.warn("Helper is deprecated and will be remove in the next major version");try{return await e.json()}catch(t){throw new a.L("serverInvalidBody",{statusCode:e.status},t instanceof Error?t:void 0)}}async function p(e){console.warn("Helper is deprecated and will be remove in the next major version");try{return await e.blob()}catch(t){throw new a.L("serverInvalidBody",{statusCode:e.status},t instanceof Error?t:void 0)}}function y(){return console.warn("Helper is deprecated and will be remove in the next major version"),Promise.resolve()}function w(e){return async t=>{try{return await t.json()}catch(n){throw new a.L("serverInvalidBody",(0,r.Z)((0,r.Z)((0,r.Z)({},e),x(t)),{},{statusCode:t.status}),n instanceof Error?n:void 0)}}}function g(e){return async t=>{try{return await t.blob()}catch(n){throw new a.L("serverInvalidBody",(0,r.Z)((0,r.Z)((0,r.Z)({},e),x(t)),{},{statusCode:t.status}),n instanceof Error?n:void 0)}}}const f={startTimeoutInMs:1e3,maxAttempts:5,factor:2};async function b(e,t,n={}){const o=(0,r.Z)((0,r.Z)({},f),n),{startTimeoutInMs:c,maxAttempts:l,factor:d}=o;let u,h=0,m=c;const p=async()=>{var e;await(e=m,new Promise((t=>setTimeout(t,e)))),m*=d,h+=1};for(;h<l;)try{return await e()}catch(y){if(u=y,i(y))throw new a.L("clientAbortedRequest",t,y);if(!s(y)&&!(0,a.N)(y)||(0,a.N)(y)&&(!y.metadata||!y.metadata.statusCode||y.metadata.statusCode<500))throw y;await p()}if((0,a.N)(u))throw function(e,t){const{reason:n,metadata:o,innerError:i}=e;return new a.L(n,(0,r.Z)((0,r.Z)({},o),t),i)}(u,{attempts:h,clientExhaustedRetries:!0});throw new a.L("serverUnexpectedError",(0,r.Z)((0,r.Z)({},t),{},{attempts:h,clientExhaustedRetries:!0}),u)}function v(e){return t=>{if(t.ok||t.status<400)return t;throw function(e,t){const{status:n}=t,o=function(e){switch(e){case 400:return"serverBadRequest";case 401:return"serverUnauthorized";case 403:return"serverForbidden";case 404:return"serverNotFound";case 429:return"serverRateLimited";case 500:return"serverInternalError";case 502:return"serverBadGateway";default:return"serverUnexpectedError"}}(n);return new a.L(o,(0,r.Z)((0,r.Z)((0,r.Z)({},e),x(t)),{},{statusCode:n}))}(e,t)}}function x(e){const{headers:t}=e;return{mediaRegion:t.get("x-media-region")||"unknown",mediaEnv:t.get("x-media-env")||"unknown"}}},242494:(e,t,n)=>{n.d(t,{WY:()=>o});var r=n(332691);async function o(e,t={},n){const{method:o="GET",endpoint:a,auth:i,params:s,headers:c,body:l,clientOptions:d={},traceContext:u}=t,{retryOptions:h}=d,m={method:o,endpoint:a,traceContext:u};return(0,r.Fr)((()=>fetch((0,r.uJ)(e,{params:s}),{method:o,body:l,headers:(0,r.B1)(c,i,u),signal:n&&n.signal}).then((0,r.j_)(m))),m,h)}},101054:(e,t,n)=>{n.d(t,{y:()=>c,b:()=>l});var r=n(415911),o=n(953307),a=n(122551),i=n(309137);const s=new Map,c=(e,t)=>{let n=s.get(e);return n||(n=new i.Q(e,t),s.set(e,n)),n},l=(e,t)=>class extends a.Component{render(){const n=this.props,{mediaClientConfig:s}=n,l=(0,r.Z)(n,["mediaClientConfig"]),d=s?c(s,t):(e=>{const t={authProvider:()=>Promise.resolve({clientId:"",token:"",baseUrl:""})};return new i.Q(t,e)})(t);return a.createElement(e,(0,o.Z)({},l,{mediaClient:d}))}}}}]);
//# sourceMappingURL=1054.PTN3KFjcFF.js.map