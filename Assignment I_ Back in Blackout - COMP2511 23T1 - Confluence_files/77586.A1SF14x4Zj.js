"use strict";(self._cf=self._cf||[]).push([[77586],{977586:(e,t,r)=>{r.d(t,{_l:()=>C,ZP:()=>I});var n=r(991332),i=r(608259);class a{constructor(e){this.config=(0,n.Z)((0,n.Z)({},{cacheSize:10,cacheMaxAge:0}),e),this.config.cacheSize=Math.max(this.config.cacheSize||0,0),this.config.cacheMaxAge=Math.max(this.config.cacheMaxAge||0,0),this.config.cacheMaxAge&&(this.config.cacheMaxAge=Math.min(this.config.cacheMaxAge,2592e6)),this.cache=this.config.cacheMaxAge&&this.config.cacheSize?new i.LRUMap(this.config.cacheSize):null}setCachedProfile(e,t){this.cache&&this.cache.set(e,{expire:Date.now()+this.config.cacheMaxAge,profile:t})}getCachedProfile(e){if(!this.cache)return null;const t=this.cache.get(e);return t?t.expire<Date.now()?(this.cache.delete(e),null):(this.setCachedProfile(e,t.profile),t.profile):null}flushCache(){this.cache&&this.cache.clear()}}const s=e=>e;function o(e,t,r=s){const n=r((()=>{const e=new Headers;return e.append("Content-Type","application/json"),e})());return fetch(new Request(e,{method:"POST",credentials:"include",mode:"cors",headers:n,body:JSON.stringify(t)})).then((e=>e.ok?e:Promise.reject({code:e.status,reason:e.statusText}))).then((e=>e.json())).then((e=>{var t,r,n,i,a;return e.errors?Promise.reject({reason:(null===(t=e.errors[0])||void 0===t?void 0:t.category)||(null===(r=e.errors[0])||void 0===r||null===(n=r.extensions)||void 0===n?void 0:n.classification)||"default",code:null===(i=e.errors[0])||void 0===i||null===(a=i.extensions)||void 0===a?void 0:a.statusCode}):e.data}))}let l=new Map;const c=class extends a{constructor(e){super(e),this.options=e,this.bypassOnFailure=!1,this.featureFlagKeys=new Map,this.isTCReadyPromise=this.createTcReadyPromise(e)}createTcReadyPromise(e){if(e.cloudId){let t=l.get(e.cloudId);return t||(t=function(e){return e.cloudId?fetch(`/gateway/api/watermelon/organization/containsAnyWorkspace?cloudId=${e.cloudId}`).then((e=>!e||e&&e.ok)):Promise.resolve(!1)}(e),l.set(e.cloudId,t)),t}return Promise.resolve(!0)}async makeFeatureFlagCheckRequest(e,t){if(!this.options.teamCentralUrl)throw new Error("options.teamCentralUrl is a required parameter for retrieving Team Central data");const r=((e,t)=>({query:"\n    query isFeatureKeyEnabled($featureKey: String!, $context: [IsFeatureEnabledContextInput]) {\n      isFeatureEnabled(featureKey: $featureKey, context: $context) {\n        enabled\n      }\n    }\n  ",variables:{featureKey:e,context:t||[]}}))(e,t);return(await o(`${this.options.teamCentralUrl}?operationName=isFeatureKeyEnabled`,r)).isFeatureEnabled.enabled}async makeRequest(e){if(!this.options.teamCentralUrl)throw new Error("options.teamCentralUrl is a required parameter for retrieving Team Central data");const t={query:"\n    fragment ReportingLinesUserPII on UserPII {\n      name\n      picture\n    }\n\n    fragment ReportingLinesUserFragment on ReportingLinesUser {\n      accountIdentifier\n      identifierType\n      pii {\n        ...ReportingLinesUserPII\n      }\n    }\n\n    query ReportingLines($aaid: String) {\n      reportingLines(aaidOrHash: $aaid) {\n        managers {\n          ...ReportingLinesUserFragment\n        }\n        reports {\n          ...ReportingLinesUserFragment\n        }\n      }\n    }\n  ",variables:{aaid:e}};return(await o(`${this.options.teamCentralUrl}?operationName=ReportingLines`,t)).reportingLines}getReportingLines(e){return this.isTCReadyPromise.then((t=>{if(t){if(!e)return Promise.reject(new Error("userId missing"));const t=this.getCachedProfile(e);return t?Promise.resolve(t):this.bypassOnFailure?Promise.resolve({}):new Promise((t=>{this.makeRequest(e).then((r=>{const n={managers:this.filterReportingLinesUser(null==r?void 0:r.managers),reports:this.filterReportingLinesUser(null==r?void 0:r.reports)};this.cache&&this.setCachedProfile(e,n),t(n)})).catch((e=>{401!==(null==e?void 0:e.status)&&403!==(null==e?void 0:e.status)||(this.bypassOnFailure=!0),t({})}))}))}return Promise.resolve({managers:[],reports:[]})}),(()=>Promise.resolve({managers:[],reports:[]})))}getFlagEnabled(e,t){return this.isTCReadyPromise.then((r=>{if(r){if(!e)return Promise.reject(new Error("featureKey missing"));if(this.featureFlagKeys.has(e))return Promise.resolve(this.featureFlagKeys.get(e));if(this.bypassOnFailure)return Promise.resolve(!1);const r=[{key:"productIdentifier",value:t||"unset"}];return new Promise((t=>{this.makeFeatureFlagCheckRequest(e,r).then((r=>{this.featureFlagKeys.set(e,r),t(r)})).catch((e=>{401!==(null==e?void 0:e.status)&&403!==(null==e?void 0:e.status)||(this.bypassOnFailure=!0),t(!1)}))}))}return Promise.resolve(!1)}),(()=>Promise.resolve(!1)))}checkWorkspaceExists(){return this.isTCReadyPromise.then((e=>e?Promise.resolve(!0):Promise.resolve(!1)),(()=>Promise.resolve(!1)))}filterReportingLinesUser(e=[]){return e.filter((e=>"ATLASSIAN_ID"===e.identifierType))}};var u=r(53567),d=r(707713);const m=["NotPermitted","Gone","TEAMS_FORBIDDEN","TEAMS_TEAM_DELETED"];function h(e){return!!e&&m.includes(e.reason)}const g=e=>{var t,r;const n=e?null===(t=e.response)||void 0===t||null===(r=t.headers)||void 0===r?void 0:r.get("atl-traceid"):void 0;return{errorStatus:null==e?void 0:e.code,errorReason:null==e?void 0:e.reason,isSLOFailure:!h(e),traceId:null!=n?n:void 0}},f=e=>{const t=e.indexOf("/");return e.slice(t+1)},p=e=>`ari:cloud:identity::team/${e}`,v=e=>(e.append("X-ExperimentalApi","teams-beta"),e.append("X-ExperimentalApi","team-members-beta"),e);async function y(e,t){const r=(e=>({query:"query TeamCard($teamId: ID!) {\n  Team: team {\n    team (id: $teamId) {\n      id\n      displayName\n      description\n      smallHeaderImageUrl\n      largeHeaderImageUrl\n      smallAvatarImageUrl\n      largeAvatarImageUrl\n      members {\n        nodes {\n          member {\n            accountId\n            name\n            picture\n          }\n        }\n      }\n    }\n  }\n}",variables:{teamId:p(e)}}))(t),{Team:i}=await o(e,r,v);return(e=>{var t;const{team:r}=e;return(0,n.Z)((0,n.Z)({},r),{},{id:f(r.id),members:null===(t=r.members)||void 0===t?void 0:t.nodes.map((({member:e})=>({id:e.accountId,fullName:e.name,avatarUrl:e.picture})))})})(i)}class P extends a{constructor(e){super(e),this.options=e}makeRequestViaGateway(e,t){if(!this.options.gatewayGraphqlUrl)throw new Error("Trying to fetch via gateway with no specified config.gatewayGraphqlUrl");return y(this.options.gatewayGraphqlUrl,e)}makeRequest(e,t){if(!this.options.url)throw new Error("config.url is a required parameter for fetching teams");const r=((e,t)=>({query:"query Team($teamId: String!, $organizationId: String) {\n  Team: Team(teamId: $teamId, organizationId: $organizationId) {\n    id,\n    description,\n    displayName,\n    largeHeaderImageUrl,\n    smallHeaderImageUrl,\n    largeAvatarImageUrl,\n    smallAvatarImageUrl,\n    members {\n      id,\n      fullName,\n      avatarUrl,\n    },\n  }\n}",variables:{teamId:e,organizationId:t||""}}))(e,t);return o(this.options.url,r).then((e=>e.Team))}getProfile(e,t,r){if(!e)return Promise.reject(new Error("teamId is missing"));const i=this.getCachedProfile(e);return i?Promise.resolve(i):new Promise(((i,a)=>{const s=(0,d.P)();r&&r((0,u.Mm)("triggered"));const o=!!this.options.gatewayGraphqlUrl&&!this.options.teamsUseV2;(o?this.makeRequestViaGateway(e,t):this.makeRequest(e,t)).then((t=>{this.cache&&this.setCachedProfile(e,t),r&&r((0,u.Mm)("succeeded",{duration:(0,d.P)()-s,gateway:o})),i(t)})).catch((e=>{r&&r((0,u.Mm)("failed",(0,n.Z)((0,n.Z)({duration:(0,d.P)()-s},g(e)),{},{gateway:o}))),a(e)}))}))}}class C extends a{constructor(e){super(e),this.options=e}async makeRequest(e,t){if(!this.options.url)throw new Error("options.url is a required parameter");const r=((e,t)=>({query:'query User($userId: String!, $cloudId: String!) {\n    User: CloudUser(userId: $userId, cloudId: $cloudId) {\n      id,\n      isCurrentUser,\n      status,\n      statusModifiedDate,\n      isBot,\n      isNotMentionable,\n      fullName,\n      nickname,\n      email,\n      meta: title,\n      location,\n      companyName,\n      avatarUrl(size: 192),\n      remoteWeekdayIndex: localTime(format: "d"),\n      remoteWeekdayString: localTime(format: "ddd"),\n      remoteTimeString: localTime(format: "h:mma"),\n    }\n  }',variables:{cloudId:e,userId:t}}))(e,t);return(e=>{const t=(0,n.Z)({},e.User),r=(new Date).getDay().toString();return t.remoteWeekdayIndex&&t.remoteWeekdayIndex!==r&&(t.remoteTimeString=`${t.remoteWeekdayString} ${t.remoteTimeString}`),{isBot:t.isBot,isCurrentUser:t.isCurrentUser,status:t.status,statusModifiedDate:t.statusModifiedDate||void 0,avatarUrl:t.avatarUrl||void 0,email:t.email||void 0,fullName:t.fullName||void 0,location:t.location||void 0,meta:t.meta||void 0,nickname:t.nickname||void 0,companyName:t.companyName||void 0,timestring:t.remoteTimeString||void 0}})(await o(this.options.url,r))}getProfile(e,t,r){if(!t)return Promise.reject(new Error("userId missing"));const i=`${e}/${t}`,a=this.getCachedProfile(i);return a?Promise.resolve(a):new Promise(((a,s)=>{const o=(0,d.P)();r&&r((0,u.Hr)("triggered")),this.makeRequest(e,t).then((e=>{this.cache&&this.setCachedProfile(i,e),r&&r((0,u.Hr)("succeeded",{duration:(0,d.P)()-o})),a(e)})).catch((e=>{r&&r((0,u.Hr)("failed",(0,n.Z)({duration:(0,d.P)()-o},g(e)))),s(e)}))}))}}const I=class{constructor(e,t){this.userClient=(null==t?void 0:t.userClient)||new C(e),this.teamClient=(null==t?void 0:t.teamClient)||new P(e),this.tcClient=function(e,t){if(null!=t&&t.teamCentralClient)return t.teamCentralClient;const r=e.teamCentralUrl;return r?new c((0,n.Z)((0,n.Z)({},e),{},{teamCentralUrl:r})):void 0}(e,t)}flushCache(){var e;this.userClient.flushCache(),this.teamClient.flushCache(),null===(e=this.tcClient)||void 0===e||e.flushCache()}getProfile(e,t,r){return this.userClient.getProfile(e,t,r)}getTeamProfile(e,t,r){return this.teamClient.getProfile(e,t,r)}getReportingLines(e){var t;return(null===(t=this.tcClient)||void 0===t?void 0:t.getReportingLines(e))||Promise.resolve({managers:[],reports:[]})}getTeamCentralBaseUrl(){var e;return null===(e=this.tcClient)||void 0===e?void 0:e.options.teamCentralBaseUrl}shouldShowGiveKudos(){return this.tcClient&&this.getTeamCentralBaseUrl()?this.tcClient.checkWorkspaceExists():Promise.resolve(!1)}}}}]);
//# sourceMappingURL=77586.A1SF14x4Zj.js.map