"use strict";(self._cf=self._cf||[]).push([[69220],{944997:(t,e,i)=>{let s;i.d(e,{O:()=>s}),function(t){t[t.DEFAULT=6e4]="DEFAULT",t[t.CREATE_PAGE=3e4]="CREATE_PAGE",t[t.CREATE_DIALOG_LOAD=6e4]="CREATE_DIALOG_LOAD",t[t.MACRO_LOAD=6e4]="MACRO_LOAD",t[t.EDITOR_LOAD=9e4]="EDITOR_LOAD",t[t.EDITOR_PUBLISH=6e4]="EDITOR_PUBLISH",t[t.TEMPLATE_EDITOR_LOAD=9e4]="TEMPLATE_EDITOR_LOAD",t[t.TEMPLATE_EDITOR_PUBLISH=6e4]="TEMPLATE_EDITOR_PUBLISH",t[t.IN_EDITOR_TEMPLATE_PANEL_LOAD=2e4]="IN_EDITOR_TEMPLATE_PANEL_LOAD",t[t.IN_EDITOR_TEMPLATES_UPDATE_CONTENT_REFRESH_EDITOR=9e4]="IN_EDITOR_TEMPLATES_UPDATE_CONTENT_REFRESH_EDITOR",t[t.HOME=2e4]="HOME",t[t.NAVIGATION_LOAD=3e4]="NAVIGATION_LOAD",t[t.PAGE_LOAD=6e4]="PAGE_LOAD",t[t.SPACE_DIRECTORY=6e4]="SPACE_DIRECTORY",t[t.SPACE_VIEWS=2e4]="SPACE_VIEWS",t[t.TEMPLATE_GALLERY_TEMPLATE_DETAIL_UPDATE=2e4]="TEMPLATE_GALLERY_TEMPLATE_DETAIL_UPDATE",t[t.TEMPLATE_PREVIEW=2e4]="TEMPLATE_PREVIEW"}(s||(s={}))},534322:(t,e,i)=>{i.d(e,{t:()=>s});class s extends Error{constructor(t){super(t),this.name="ExperienceTimeoutError"}}},866380:(t,e,i)=>{i.d(e,{D:()=>A});var s=i(29298),r=i(197728),n=i.n(r),a=i(616158),o=i(147543),c=i(12793),u=i(991332),h=i(574409),l=i(534322),d=i(972416),b=i(69210);class m{constructor(){(0,s.Z)(this,"callbacks",new Map)}start(){let t;document.addEventListener("freeze",(()=>{t=performance.now()})),document.addEventListener("resume",(()=>{if("number"!=typeof t)return;const e=performance.now();for(const i of this.callbacks.values())i(e-t)}))}subscribe(t,e){this.callbacks.set(t,e)}unsubscribe(t){this.callbacks.delete(t)}}const E=(0,b.default)((()=>new m));class T{constructor({name:t,id:e,timeout:i,startTime:r=window.performance.now(),attributes:n,onStart:a,onSuccess:o,onFailure:c,onAbort:l}){(0,s.Z)(this,"name",void 0),(0,s.Z)(this,"id",void 0),(0,s.Z)(this,"timeout",void 0),(0,s.Z)(this,"freezeTime",0),(0,s.Z)(this,"stopState",null),(0,s.Z)(this,"startTime",void 0),(0,s.Z)(this,"attributes",void 0),(0,s.Z)(this,"onStop",void 0),(0,s.Z)(this,"onSuccess",void 0),(0,s.Z)(this,"onFailure",void 0),(0,s.Z)(this,"onAbort",void 0),this.name=t,this.id=e,this.timeout=i,this.startTime=r,this.attributes=n,this.onSuccess=o,this.onFailure=c,this.onAbort=l;const d={action:"taskStart",name:t,id:e,startTime:r,timeout:i,attributes:(0,u.Z)((0,u.Z)({},n),(0,h.aX)())};a&&(this.onStop=a(d)),E().subscribe(t,(t=>{this.freezeTime+=t}))}succeed(t){this.hasStopped||(this.onSuccess&&this.onSuccess(),this.stop({action:"taskSuccess",name:this.name,id:this.id,startTime:this.startTime,duration:this.getAbsoluteDuration(),activeDuration:this.getDurationAdjustedForActive(),adjustedDuration:this.getDurationAdjustedForTabActivity(),attributes:(0,u.Z)((0,u.Z)((0,u.Z)({},this.attributes),t),(0,h.aX)())}))}fail({error:t,attributes:e}){this.hasStopped||(this.onFailure&&this.onFailure(),this.stop({action:"taskFail",name:this.name,id:this.id,startTime:this.startTime,duration:this.getAbsoluteDuration(),activeDuration:this.getDurationAdjustedForActive(),adjustedDuration:this.getDurationAdjustedForTabActivity(),error:t,attributes:(0,u.Z)((0,u.Z)({},this.attributes),e)}))}abort({reason:t,attributes:e,checkForTimeout:i=!0}){if(this.hasStopped)return;const s=this.getDurationAdjustedForTabActivity();i&&null!=this.timeout&&s>=this.timeout?this.fail({attributes:e,error:new l.t(`${this.name} failed to complete in ${this.timeout}ms`)}):(this.onAbort&&this.onAbort(),this.stop({action:"taskAbort",name:this.name,id:this.id,startTime:this.startTime,duration:this.getAbsoluteDuration(),activeDuration:this.getDurationAdjustedForActive(),adjustedDuration:s,reason:t,checkForTimeout:i,attributes:(0,u.Z)((0,u.Z)({},this.attributes),e)}))}stopOn(t){t&&("taskSuccess"===t.action?this.succeed({}):"taskAbort"===t.action?this.abort({reason:t.reason,checkForTimeout:t.checkForTimeout}):"taskFail"===t.action&&this.fail({error:t.error}))}getState(){return{timeout:this.timeout,hasStopped:this.hasStopped,stopState:this.stopState,startTime:this.startTime,name:this.name,attributes:this.attributes}}get hasStopped(){return null!==this.stopState}stop(t){this.stopState=t.action,this.onStop&&this.onStop(t),E().unsubscribe(this.name)}getAbsoluteDuration(){return Math.round(window.performance.now()-this.startTime)}getDurationAdjustedForTabActivity(){return this.getAbsoluteDuration()-(0,d.y)().getInactiveMillisecondsSince(this.startTime)}getDurationAdjustedForActive(){return this.getAbsoluteDuration()-this.freezeTime}}class A{constructor(){(0,s.Z)(this,"experiences",{}),(0,s.Z)(this,"subscribers",[]),(0,s.Z)(this,"logger",(0,a.j)("ExperienceTracker")),E().start(),window.addEventListener("pagehide",(()=>{this.abort({reason:"Window unloading"})}))}start({name:t,id:e=n()(),timeout:i,startTime:s,attributes:r,onSuccess:a,onFailure:o,onAbort:c,collect:u}){const h=this.experiences[t];if(h&&h.id===e)return;h&&h.abort({reason:"Aborted because the same experience was started with a new id"});const l=new T({name:t,id:e,timeout:i,startTime:s,attributes:r,onSuccess:a,onFailure:o,onAbort:c,onStart:t=>{this.emit(t);let e=()=>{};if(u){const t=[];e=this.subscribe((e=>{("taskStart"===e.action||t.some((t=>t.name===e.name&&"taskStart"===t.action)))&&(t.push(e),u(t,l))}))}return t=>{e(),this.emit(t)}}});this.experiences[t]=l}succeed({name:t,attributes:e}){const i=this.experiences[t];i&&i.succeed(e)}fail({name:t,error:e,attributes:i}){Object.values(this.experiences).forEach((s=>{null!=t&&s.name!==t||s.fail({error:e,attributes:i})}))}abort({name:t,reason:e,attributes:i,checkForTimeout:s}){Object.values(this.experiences).forEach((r=>{null!=t&&r.name!==t||r.abort({reason:e,checkForTimeout:s,attributes:i})}))}stopOnError({error:t,name:e,attributes:i}){const s=function(t){return(0,o.OG)(t)?`Aborted because of session expiration error: ${t.toString()}`:(0,c.S)(t)?`Aborted because of network error: ${t.toString()}`:void 0}(t);s?this.abort({name:e,reason:s,checkForTimeout:!1,attributes:i}):this.fail({name:e,error:t,attributes:i})}subscribe(t){if("function"!=typeof t)throw new Error("Subscriber must be a function");return this.subscribers.push(t),()=>{this.subscribers=this.subscribers.filter((e=>e!==t))}}getExperienceState(t){return this.experiences[t]?this.experiences[t].getState():null}emit(t){this.logger.debug`${t.action} ${t}`,this.subscribers.forEach((e=>{try{e(t)}catch(i){this.logger.error`Error occurred in ExperienceTracker subscriber ${i} when handling event ${t}`}}))}}},972416:(t,e,i)=>{i.d(e,{y:()=>o});var s=i(29298),r=i(69210),n=i(616158);class a{constructor({maxIntervalsToStore:t}={}){(0,s.Z)(this,"inactivityIntervals",[]),(0,s.Z)(this,"logger",(0,n.j)("TabInactivityTracker")),(0,s.Z)(this,"maxIntervalsToStore",void 0),(0,s.Z)(this,"onVisibilityChange",(()=>{document.hidden?(this.inactivityIntervals.length>=this.maxIntervalsToStore&&this.inactivityIntervals.splice(this.maxIntervalsToStore-1),this.inactivityIntervals.unshift([window.performance.now(),null])):0===this.inactivityIntervals.length||null!=this.inactivityIntervals[0][1]?this.logger.error`Invariant violation: tab is currently active, but inactivity intervals are in inconsistent state`:this.inactivityIntervals[0][1]=window.performance.now()}));this.maxIntervalsToStore="number"==typeof t?t:100}initialize(){return document.hidden&&this.onVisibilityChange(),document.addEventListener("visibilitychange",this.onVisibilityChange),{teardown:()=>{document.removeEventListener("visibilitychange",this.onVisibilityChange)}}}getInactiveMillisecondsSince(t){let e=0;for(const[i,s]of this.inactivityIntervals){const r=s||window.performance.now();if(t>r)break;e+=r-Math.max(i,t)}return e}}const o=(0,r.default)((()=>{const t=new a;return t.initialize(),t}))},275513:(t,e,i)=>{i.d(e,{Nq:()=>m,OV:()=>E,Cf:()=>T});var s=i(991332),r=i(69210),n=i(699692),a=i(443033),o=i(596207),c=i(598728),u=i(199319),h=i(866380),l=i(534322);const d=new Set([u.RNN,u.dc_,u.pXy,u.z09]),b=new Set;function m(){return Array.from(b).pop()}const E=(0,r.default)((()=>{const t=new h.D;return/bot/i.test(window.navigator.userAgent)||t.subscribe((e=>{!function({action:t,name:e}){d.has(e)&&("taskStart"===t?b.add(e):b.delete(e),(0,o.U)().updateContext({slaExperience:m()}))}(e),(0,a.getAnalyticsWebClient)().then((t=>{t.sendOperationalEvent((0,n.p)(e))}));const i=[`action:${e.action}`,`isActiveTab:${"visible"===document.visibilityState}`];if(e.attributes)for(const t in e.attributes)i.push(`${t}:${e.attributes[t]}`);(0,o.U)().incrementCounter(`experience-tracker:${e.name}`,i),"taskFail"===e.action&&d.has(e.name)&&(e.error instanceof l.t||((0,c.NP)(e.error,{failedSlaExperience:e.name}),(0,o.U)().submitError(e.error,{attribution:"sla"}))),e.name===u.bbO&&A(t,e)})),t}));function T(t,e,i){E().stopOnError({name:t,error:e,attributes:i})}const A=(t,e)=>{((t,e,i)=>{switch(e.action){case"taskStart":t.start((0,s.Z)((0,s.Z)({},e),{},{name:i}));break;case"taskSuccess":t.succeed((0,s.Z)((0,s.Z)({},e),{},{name:i}));break;case"taskFail":t.fail((0,s.Z)((0,s.Z)({},e),{},{name:i}));break;case"taskAbort":t.abort((0,s.Z)((0,s.Z)({},e),{},{name:i}))}})(t,e,e.attributes&&"space"===e.attributes.contentType?u.ywK:u.z09)}},147543:(t,e,i)=>{i.d(e,{RX:()=>a,Fo:()=>o,OG:()=>c});var s=i(853102),r=i(251846);const n="Session expired";class a extends r.K{constructor(t,e){super(`${t} Session expired`,e)}}function o(t){var e,i;if(!t)return!1;if(t instanceof a)return!0;if(-1!=((null!=(i=t)?i.message:i)||"").indexOf(n))return!0;return 401==(null!=(e=t)&&null!=(e=e.extensions)?e.statusCode:e)}function c(t){if(!t)return!1;if(o(t))return!0;if((0,s.MS)(t)){const{graphQLErrors:e,networkError:i}=t;if(o(i))return!0;if((e||[]).some(o))return!0}return!1}},57230:(t,e,i)=>{i.d(e,{E:()=>o});var s=i(29298),r=i(913879);class n{constructor(t={}){(0,s.Z)(this,"store",void 0),this.store=t}serialize(t){if(Array.isArray(t))return`[${t.map(this.serialize,this).join(",")}]`;if("object"==typeof t){return`{${Object.entries(null!=t?t:{}).filter((t=>void 0!==t[1])).sort(((t,e)=>t[0]<e[0]?-1:t[0]>e[0]?1:0)).map((([t,e])=>`${t}:${this.serialize(e)}`)).join(",")}}`}return String(t)}toHashKey({name:t,variables:e}){return`${t}:${this.serialize(null!=e?e:{})}`}load(t,e,{refetchIfNotClaimed:i=!0}={}){const s=this.toHashKey(t);return(!this.store[s]||i&&(0,r.wp)(this.store[s]))&&(this.store[s]=(0,r.LW)(e())),this.store[s]}claim(t,e){const i=this.toHashKey(t),s=this.store[i];return s?s.catch((()=>(delete this.store[i],null))).then((t=>(delete this.store[i],e?e(t):t&&t.data?t:null))):Promise.resolve(null)}}let a=null;function o(){return null===a&&(window.QUERY_PRELOADER_RESULTS||(window.QUERY_PRELOADER_RESULTS={}),a=new n(window.QUERY_PRELOADER_RESULTS)),a}},536347:(t,e,i)=>{i.d(e,{b:()=>c});var s=i(984218),r=i(443709),n=i(616158),a=i(57230);const o=(0,n.j)("PreloadedQueryLink"),c=()=>new s.ApolloLink(((t,e)=>{const{operationName:i,variables:s}=t;return i?new r.Z((r=>{let n=null;return(0,a.E)().claim({name:i,variables:s}).then((s=>{s?(o.debug`Query matched: ${i} ${s}`,r.next(s),r.complete()):n=e(t).subscribe({next:r.next.bind(r),error:r.error.bind(r),complete:r.complete.bind(r)})})),()=>{n&&n.unsubscribe()}})):e(t)}))}}]);
//# sourceMappingURL=69220.RAZyMGpvqW.js.map